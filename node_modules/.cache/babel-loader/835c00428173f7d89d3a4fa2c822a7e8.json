{"ast":null,"code":"import _objectSpread from\"/Users/jacobcoles/Desktop/LT2216/Lab2and4/react-xstate-colourchanger/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import{actions,assign}from\"xstate\";const send=actions.send,cancel=actions.cancel;function say(text){return send(_context=>({type:\"SPEAK\",value:text}));}function listen(){return send('LISTEN');}const grammar={\"john\":{person:\"John Appleseed\"},\"sarah\":{person:\"Sarah Swiggity\"},\"daddy\":{person:\"The big lad\"},\"on monday\":{day:\"Friday\"},\"on tuesday\":{day:\"Thursday\"},\"on wednesday\":{day:\"Friday\"},\"on thursday\":{day:\"Thursday\"},\"on friday\":{day:\"Friday\"},\"on saturday\":{day:\"Thursday\"},\"on sunday\":{day:\"Friday\"},\"at 8\":{time:\"8:00\"},\"at 9\":{time:\"9:00\"},\"at 10\":{time:\"10:00\"},\"at 11\":{time:\"11:00\"},\"at 12\":{time:\"12:00\"},\"at 13\":{time:\"13:00\"},\"at 14\":{time:\"14:00\"},\"at 15\":{time:\"15:00\"},\"at 16\":{time:\"16:00\"},\"8\":{time:\"8:00\"},\"9\":{time:\"9:00\"},\"10\":{time:\"10:00\"},\"11\":{time:\"11:00\"},\"12\":{time:\"12:00\"},\"13\":{time:\"13:00\"},\"14\":{time:\"14:00\"},\"15\":{time:\"15:00\"},\"16\":{time:\"16:00\"},\"yes\":{bool_val:true},\"yeah\":{bool_val:true},\"ok\":{bool_val:true},\"sure\":{bool_val:true},\"ja\":{bool_val:true},\"no\":{bool_val:false},\"nope\":{bool_val:false},\"nein\":{bool_val:false},\"nej\":{bool_val:false},\"appointment\":{initial_function:\"appt\"},\"an appointment\":{initial_function:\"appt\"},\"set up an appointment\":{initial_function:\"appt\"},\"make an appointment\":{initial_function:\"appt\"},\"to do\":{initial_function:\"todo\"},\"set up a to do\":{initial_function:\"todo\"},\"make to do\":{initial_function:\"todo\"},\"make a to do\":{initial_function:\"todo\"},\"timer\":{initial_function:\"timer\"},\"make a timer\":{initial_function:\"timer\"},\"set a timer\":{initial_function:\"timer\"},\"set timer\":{initial_function:\"timer\"}};function promptAndAsk(prompt){return{initial:'prompt',states:{prompt:{entry:say(prompt),on:{ENDSPEECH:'ask'}},ask:{entry:[send('LISTEN'),send('MAXSPEECH',{delay:4000,id:'maxspeech_cancel'})]}}};}const proxyurl=\"https://cors-anywhere.herokuapp.com/\";// can try instead \"https://boiling-depths-26621.herokuapp.com/\"\nconst rasaurl='https://rasajacobcoles.herokuapp.com/model/parse';function nluRequest(){return{initial:'http_timeout',invoke:{id:\"rasaquery\",src:(context,event)=>{return fetch(new Request(proxyurl+rasaurl,{method:'POST',headers:{'Origin':'http://localhost:3000/'},// only required with proxy\nbody:\"{\\\"text\\\": \\\"\".concat(context.query,\"\\\"}\")})).then(data=>data.json());},onDone:[{target:'.invalid_query',cond:(context,event)=>{return event.data.intent.confidence<0.7;}},{target:'.valid_query',actions:[assign((context,event)=>{return{snippet:event.data.intent.name};}),(context,event)=>console.log(event.data)]}],onError:{target:'#root.dm',actions:say(\"Sorry, there was an error. \")}},states:{http_timeout:{invoke:{src:(context,event)=>{return new Promise(resolve=>{setTimeout(()=>{resolve();},2000);});}},onDone:send('HTTP_TIMEOUT')},invalid_query:{entry:send('INVALID_QUERY')},valid_query:{entry:send('VALID_QUERY')}}};}const commands=['stop','help'];export const dmMachine={initial:'main',id:'init',on:{MAXSPEECH:'.maxspeech',RECOGNISED:[{target:\".stop\",cond:context=>context.recResult==='stop'},{target:\".help\",cond:context=>context.recResult==='help'}]},states:{main:{initial:'clicky',states:{hist:{type:'history',history:'shallow'},clicky:{on:{CLICK:'begin'}},begin:{initial:\"prompt\",id:\"welcome\",on:{RECOGNISED:{target:\"query\",actions:assign(context=>{return{query:context.recResult};}),cond:context=>!commands.includes(context.recResult)}},states:{prompt:_objectSpread({},promptAndAsk(\"Would you like to book an appointment, set a timer or add a to do item?\"))}},query:{initial:'rasa_query',on:{RECOGNISED:{cond:context=>!commands.includes(context.recResult),target:'.rasa_query',actions:assign(context=>{return{query:context.recResult};})},INVALID_QUERY:{target:'.invalid_query'},VALID_QUERY:{target:'select_task'},HTTP_TIMEOUT:{target:'.http_timeout'}},states:{rasa_query:_objectSpread({},nluRequest()),invalid_query:_objectSpread({},promptAndAsk(\"Sorry, I don't understand, please say that again\")),http_timeout:_objectSpread({},promptAndAsk(\"Sorry, the rasa server isnt responding right now. Try again.\"))}},select_task:{initial:\"select\",states:{select:{always:[{cond:context=>context.snippet===\"Appointment\",target:\"#who\"},{cond:context=>context.snippet===\"TODO\",target:\"#todo\"},{cond:context=>context.snippet===\"Timer\",target:\"#timer\"},{cond:context=>!commands.includes(context.recResult),target:\"prompt\"}]},prompt:{entry:say(\"Sorry, that isn't a valid answer\"),on:{ENDSPEECH:\"#welcome\"}}}},todo:{id:\"todo\",initial:\"prompt\",on:{ENDSPEECH:\"#init\"},states:{prompt:{entry:say(\"You are in the to do thing.\")}}},timer:{id:\"timer\",initial:\"prompt\",on:{ENDSPEECH:\"#init\"},states:{prompt:{entry:say(\"You are in the timer thing.\")}}},who:{id:\"who\",initial:\"prompt\",on:{RECOGNISED:[{cond:context=>\"person\"in(grammar[context.recResult]||{}),actions:assign(context=>{return{person:grammar[context.recResult].person};}),target:\"day\"},{target:\".nomatch\",cond:context=>!commands.includes(context.recResult)}]},states:{prompt:_objectSpread({},promptAndAsk(\"Who are you meeting with?\")),nomatch:{entry:say(\"Sorry I don't know them\"),on:{ENDSPEECH:\"prompt\"}}}},day:{initial:\"prompt\",on:{RECOGNISED:[{cond:context=>\"day\"in(grammar[context.recResult]||{}),actions:assign(context=>{return{day:grammar[context.recResult].day};}),target:\"whole_day_query\"},{target:\".nomatch\",cond:context=>!commands.includes(context.recResult)}]},states:{prompt:{entry:send(context=>({type:\"SPEAK\",value:\"OK. \".concat(context.person,\". On which day is your meeting?\")})),on:{ENDSPEECH:\"ask\"}},ask:{entry:[send('LISTEN'),send('MAXSPEECH',{delay:5000,id:'maxspeech_cancel'})]},nomatch:{entry:say(\"Can you please repeat that\"),on:{ENDSPEECH:\"ask\"}}}},whole_day_query:{initial:\"prompt\",on:{RECOGNISED:[{cond:context=>\"bool_val\"in(grammar[context.recResult]||{})&&grammar[context.recResult].bool_val==false,actions:assign(context=>{return{bool_val:grammar[context.recResult].bool_val};}),target:\"meeting_time_query\"},{cond:context=>\"bool_val\"in(grammar[context.recResult]||{})&&grammar[context.recResult].bool_val==true,actions:assign(context=>{return{bool_val:grammar[context.recResult].bool_val};}),target:\"confirm_full_day\"},{target:\".nomatch\",cond:context=>!commands.includes(context.recResult)}]},states:{prompt:{entry:send(context=>({type:\"SPEAK\",value:\"Will the meeting take the whole day?\"})),on:{ENDSPEECH:\"ask\"}},ask:{entry:[send('LISTEN'),send('MAXSPEECH',{delay:5000,id:'maxspeech_cancel'})]},nomatch:{entry:say(\"Can you please repeat that\"),on:{ENDSPEECH:\"ask\"}}}},meeting_time_query:{initial:\"prompt\",on:{RECOGNISED:[{cond:context=>\"time\"in(grammar[context.recResult]||{}),actions:assign(context=>{return{time:grammar[context.recResult].time};}),target:\"confirm_day_and_time\"},{target:\".nomatch\",cond:context=>!commands.includes(context.recResult)}]},states:{prompt:{entry:send(context=>({type:\"SPEAK\",value:\"What time is the meeting?\"})),on:{ENDSPEECH:\"ask\"}},ask:{entry:[send('LISTEN'),send('MAXSPEECH',{delay:5000,id:'maxspeech_cancel'})]},nomatch:{entry:say(\"Can you please repeat that\"),on:{ENDSPEECH:\"ask\"}}}},confirm_day_and_time:{initial:\"prompt\",on:{RECOGNISED:[{cond:context=>\"bool_val\"in(grammar[context.recResult]||{})&&grammar[context.recResult].bool_val==false,actions:assign(context=>{return{bool_val:grammar[context.recResult].bool_val};}),target:\"#init\"},{cond:context=>\"bool_val\"in(grammar[context.recResult]||{})&&grammar[context.recResult].bool_val==true,actions:assign(context=>{return{bool_val:grammar[context.recResult].bool_val};}),target:\"finalise\"},{target:\".nomatch\",cond:context=>!commands.includes(context.recResult)}]},states:{prompt:{entry:send(context=>({type:\"SPEAK\",value:\"Do you want to create an appointment with \".concat(context.person,\" on \").concat(context.day,\" at \").concat(context.time,\"?\")})),on:{ENDSPEECH:\"ask\"}},ask:{entry:[send('LISTEN'),send('MAXSPEECH',{delay:5000,id:'maxspeech_cancel'})]},nomatch:{entry:say(\"Can you please repeat that\"),on:{ENDSPEECH:\"ask\"}}}},confirm_full_day:{initial:\"prompt\",on:{RECOGNISED:[{cond:context=>\"bool_val\"in(grammar[context.recResult]||{})&&grammar[context.recResult].bool_val==false,actions:assign(context=>{return{bool_val:grammar[context.recResult].bool_val};}),target:\"#init\"},{cond:context=>\"bool_val\"in(grammar[context.recResult]||{})&&grammar[context.recResult].bool_val==true,actions:assign(context=>{return{bool_val:grammar[context.recResult].bool_val};}),target:\"finalise\"},{target:\".nomatch\",cond:context=>!commands.includes(context.recResult)}]},states:{prompt:{entry:send(context=>({type:\"SPEAK\",value:\"Do you want to create an appointment with \".concat(context.person,\" on \").concat(context.day,\" for the whole day?\")})),on:{ENDSPEECH:\"ask\"}},ask:{entry:[send('LISTEN'),send('MAXSPEECH',{delay:5000,id:'maxspeech_cancel'})]},nomatch:{entry:say(\"Can you please repeat that\"),on:{ENDSPEECH:\"ask\"}}}},finalise:{entry:say(\"Your appointment has been created.\"),on:{ENDSPEECH:\"#init.main\"}},say_error:{target:'main',actions:say(\"Sorry, there was an error. \")}}},maxspeech:{entry:say(\"Sorry,\"),on:{ENDSPEECH:[{cond:context=>context.maxspeech_count<3,target:'main.hist'},{actions:[assign(context=>{return{maxspeech_count:0};}),say(\"Cancelled because you don't say nutting\")],target:'#init'}]}},stop:{entry:say(\"Ok, program stopped\"),target:'main'},help:{entry:say(\"I'm supposed to help you but I won't\"),target:'main'}}};","map":{"version":3,"sources":["/Users/jacobcoles/Desktop/LT2216/Lab2and4/react-xstate-colourchanger/src/dmAppointmentUpdated.ts"],"names":["actions","assign","send","cancel","say","text","_context","type","value","listen","grammar","person","day","time","bool_val","initial_function","promptAndAsk","prompt","initial","states","entry","on","ENDSPEECH","ask","delay","id","proxyurl","rasaurl","nluRequest","invoke","src","context","event","fetch","Request","method","headers","body","query","then","data","json","onDone","target","cond","intent","confidence","snippet","name","console","log","onError","http_timeout","Promise","resolve","setTimeout","invalid_query","valid_query","commands","dmMachine","MAXSPEECH","RECOGNISED","recResult","main","hist","history","clicky","CLICK","begin","includes","INVALID_QUERY","VALID_QUERY","HTTP_TIMEOUT","rasa_query","select_task","select","always","todo","timer","who","nomatch","whole_day_query","meeting_time_query","confirm_day_and_time","confirm_full_day","finalise","say_error","maxspeech","maxspeech_count","stop","help"],"mappings":"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","sourcesContent":["import { MachineConfig, actions, Action, assign } from \"xstate\";\nconst { send, cancel } = actions;\n\n\n\nfunction say(text: string): Action<SDSContext, SDSEvent> {\n    return send((_context: SDSContext) => ({ type: \"SPEAK\", value: text }))\n}\n\nfunction listen(): Action<SDSContext, SDSEvent> {\n    return send('LISTEN')\n}\n\nconst grammar: { [index: string]: { person?: string, day?: string, time?: string, bool_val?: boolean, initial_function: string } } = {\n    \"john\": { person: \"John Appleseed\" },\n    \"sarah\": { person: \"Sarah Swiggity\" },\n    \"daddy\": { person: \"The big lad\" },\n    \"on monday\": { day: \"Friday\" },\n    \"on tuesday\": { day: \"Thursday\" },\n    \"on wednesday\": { day: \"Friday\" },\n    \"on thursday\": { day: \"Thursday\" },\n    \"on friday\": { day: \"Friday\" },\n    \"on saturday\": { day: \"Thursday\" },\n    \"on sunday\": { day: \"Friday\" },\n    \"at 8\": { time: \"8:00\" },\n    \"at 9\": { time: \"9:00\" },\n    \"at 10\": { time: \"10:00\" },\n    \"at 11\": { time: \"11:00\" },\n    \"at 12\": { time: \"12:00\" },\n    \"at 13\": { time: \"13:00\" },\n    \"at 14\": { time: \"14:00\" },\n    \"at 15\": { time: \"15:00\" },\n    \"at 16\": { time: \"16:00\" },\n    \"8\": { time: \"8:00\" },\n    \"9\": { time: \"9:00\" },\n    \"10\": { time: \"10:00\" },\n    \"11\": { time: \"11:00\" },\n    \"12\": { time: \"12:00\" },\n    \"13\": { time: \"13:00\" },\n    \"14\": { time: \"14:00\" },\n    \"15\": { time: \"15:00\" },\n    \"16\": { time: \"16:00\" },\n    \"yes\": { bool_val: true },\n\t\"yeah\": { bool_val: true },\n\t\"ok\": { bool_val: true },\n\t\"sure\": { bool_val: true },\n\t\"ja\": { bool_val: true },\n    \"no\": { bool_val: false },\n\t\"nope\": { bool_val: false },\n\t\"nein\": { bool_val: false },\n\t\"nej\": { bool_val: false },\n\t\"appointment\": { initial_function: \"appt\" },\n\t\"an appointment\": { initial_function: \"appt\" },\n\t\"set up an appointment\": { initial_function: \"appt\" },\n\t\"make an appointment\": { initial_function: \"appt\" },\n\t\"to do\": { initial_function: \"todo\" },\n\t\"set up a to do\": { initial_function: \"todo\" },\n\t\"make to do\": { initial_function: \"todo\" },\n\t\"make a to do\": { initial_function: \"todo\" },\n\t\"timer\": { initial_function: \"timer\" },\n\t\"make a timer\": { initial_function: \"timer\" },\n\t\"set a timer\": { initial_function: \"timer\" },\n\t\"set timer\": { initial_function: \"timer\" },\n}\n\nfunction promptAndAsk(prompt: string): MachineConfig<SDSContext, any, SDSEvent> {\n\t\n    return ({\n        initial: 'prompt',\n        states: {\n            prompt: {\n                entry: say(prompt),\n                on: { ENDSPEECH: 'ask' }\n            },\n            ask: {\n                entry: [\n\t\t\t\t\tsend('LISTEN'),\n\t\t\t\t\tsend( 'MAXSPEECH', { delay: 4000, id: 'maxspeech_cancel' } )\n\t\t\t\t]\n            },\n        }\n    })\n}\n\nconst proxyurl = \"https://cors-anywhere.herokuapp.com/\" // can try instead \"https://boiling-depths-26621.herokuapp.com/\"\nconst rasaurl = 'https://rasajacobcoles.herokuapp.com/model/parse'\nfunction nluRequest(): MachineConfig<SDSContext, any, SDSEvent> {\n    return ({\n\t\tinitial: 'http_timeout',\n\t\tinvoke: {\n\t\t\tid: \"rasaquery\",\n\t\t\tsrc: (context, event) => {\n\t\t\t\t\n\t\t\t\treturn fetch(new Request(proxyurl + rasaurl, {\n\t\t        method: 'POST',\n\t\t        headers: { 'Origin': 'http://localhost:3000/' }, // only required with proxy\n\t\t        body: `{\"text\": \"${context.query}\"}`\n\t\t\t\t}))\n\t\t        .then(data => data.json());\n\n\t\t\t},\n\t\t\tonDone: [\n\t\t\t\t{\n\t\t\t\t\ttarget: '.invalid_query',\n\t\t\t\t\tcond: (context, event)=> { return ((event.data.intent.confidence) < 0.7) }\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: '.valid_query',\n                    actions: [\n\t\t\t\t\t\tassign((context, event) => { return {snippet: event.data.intent.name }}),\n\t\t\t\t\t\t(context:SDSContext, event:any) => console.log(event.data),\n\t\t\t\t\t]\n\t\t\t\t},\n\t\t\t],\n\t\t\tonError: {\n\t\t\t\t\ttarget: '#root.dm',\n\t\t\t\t\tactions: say(\"Sorry, there was an error. \")\n\t\t\t\t},\n\t\t},\n\t\tstates: {\n\t\t\thttp_timeout: {\n\t\t\t\tinvoke: {\n\t\t\t\t\tsrc: (context, event) => {\n\t\t\t\t\t\treturn new Promise((resolve) => {\n\t\t\t\t\t\t\t\tsetTimeout(() => { resolve() }, 2000) \n\t\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tonDone: send('HTTP_TIMEOUT')\n\t\t\t},\n\t\t\tinvalid_query: {\n\t\t\t\tentry: send('INVALID_QUERY'),\n\t\t\t},\n\t\t\tvalid_query: {\n\t\t\t\tentry: send('VALID_QUERY'),\n\t\t\t},\n\t\t},\n\t})\n}\n\nconst commands = ['stop', 'help']\n\nexport const dmMachine: MachineConfig<SDSContext, any, SDSEvent> = ({\n    initial: 'main',\n    id: 'init',\n    on: {\n\t\tMAXSPEECH: '.maxspeech',\n\t\tRECOGNISED: \n\t\t\t[\n\t\t\t\t{\n\t\t\t\t\ttarget: \".stop\",\n\t\t\t\t\tcond: (context) => context.recResult === 'stop' ,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: \".help\",\n\t\t\t\t\tcond: (context) => context.recResult === 'help' ,\n\t\t\t\t}\n\t\t\t],\n\t},\n    states: {\n        main: {\n\t\t\tinitial: 'clicky',\n\t\t\tstates: {\n\t\t\t\thist: { \n\t\t\t\t\ttype: 'history',\n\t\t\t\t\thistory: 'shallow',\n\t\t\t\t },\n\t\t\t\tclicky: {\n\t\t\t\t\ton: {\n\t\t\t\t\t\tCLICK: 'begin'\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tbegin:{\n\t\t\t\t\tinitial: \"prompt\",\n\t\t\t\t\tid: \"welcome\",\n\t\t\t\t\ton: {\n\t\t\t\t\t\tRECOGNISED: {\n\t\t\t\t\t\t\ttarget: \"query\",\n\t\t\t\t\t\t\tactions: assign((context) => { return { query: context.recResult } }),\n\t\t\t\t\t\t\tcond: (context) => !commands.includes(context.recResult)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tstates: {\n\t\t\t\t\t\tprompt: {\n\t\t\t\t\t\t\t...promptAndAsk(\"Would you like to book an appointment, set a timer or add a to do item?\")\n\t\t\t\t\t\t}\n\t\t            }\n\t\t\t\t},\n\t\t\t\tquery: {\n\t\t\t\t\tinitial:'rasa_query',\n\t\t\t\t\ton: {\n\t\t\t\t\t\tRECOGNISED: {\n\t\t\t\t\t\t\tcond: (context)=> !commands.includes(context.recResult),\n\t\t\t\t\t\t\ttarget: '.rasa_query',\n\t\t\t\t\t\t\tactions: assign((context) => { return { query: context.recResult } })\n\t\t\t\t\t\t},\n\t\t\t\t\t\tINVALID_QUERY: {\n\t\t\t\t\t\t\ttarget: '.invalid_query'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tVALID_QUERY: {\n\t\t\t\t\t\t\ttarget: 'select_task'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tHTTP_TIMEOUT: {\n\t\t\t\t\t\t\ttarget: '.http_timeout'\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tstates: {\n\t\t\t\t\t\trasa_query: {\n\t\t\t\t\t\t\t...nluRequest()\n\t\t\t\t\t\t},\n\t\t\t\t\t\tinvalid_query: {\n\t\t\t\t\t\t\t...promptAndAsk(\"Sorry, I don't understand, please say that again\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t\thttp_timeout: {\n\t\t\t\t\t\t\t...promptAndAsk(\"Sorry, the rasa server isnt responding right now. Try again.\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tselect_task: {\n\t\t\t\t\tinitial: \"select\",\n\t\t\t\t\tstates: {\n\t\t\t\t\t\tselect: {\n\t\t\t\t\t\t\talways: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcond: (context) => context.snippet ===  \"Appointment\",\n\t\t\t\t\t\t\t\t\ttarget: \"#who\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcond: (context) => context.snippet  ===  \"TODO\",\n\t\t\t\t\t\t\t\t\ttarget: \"#todo\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcond: (context) => context.snippet  ===  \"Timer\",\n\t\t\t\t\t\t\t\t\ttarget: \"#timer\"\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tcond: (context) => !commands.includes(context.recResult),\n\t\t\t\t\t\t\t\t\ttarget: \"prompt\"\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprompt: { \n\t\t\t\t\t\t\tentry: say(\"Sorry, that isn't a valid answer\"),\n\t\t\t\t\t\t\ton: { ENDSPEECH: \"#welcome\"} \n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\ttodo: {\n\t\t            id: \"todo\",\n\t\t\t\t\tinitial: \"prompt\",\n\t\t\t\t\ton: {\n\t\t\t\t\t\tENDSPEECH: \"#init\"\n\t\t\t\t\t},\n\t\t\t\t\tstates: {\n\t\t\t\t\t\tprompt: {\n\t\t\t\t\t\t\tentry: say(\"You are in the to do thing.\"),\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttimer: {\n\t\t            id: \"timer\",\n\t\t\t\t\tinitial: \"prompt\",\n\t\t\t\t\ton: {\n\t\t\t\t\t\tENDSPEECH: \"#init\"\n\t\t\t\t\t},\n\t\t\t\t\tstates: {\n\t\t\t\t\t\tprompt: {\n\t\t\t\t\t\t\tentry: say(\"You are in the timer thing.\")\n\t\t\t\t\t\t},\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t        who: {\n\t\t            id: \"who\",\n\t\t            initial: \"prompt\",\n\t\t            on: {\n\t\t                RECOGNISED: [{\n\t\t                    cond: (context) => \"person\" in (grammar[context.recResult] || {}),\n\t\t                    actions: assign((context) => { return { person: grammar[context.recResult].person }}),\n\t\t                    target: \"day\"\n\t\t                },\n\t\t                { \n\t\t\t\t\t\t\ttarget: \".nomatch\" ,\n\t\t\t\t\t\t\tcond: (context) => !commands.includes(context.recResult)\n\t\t\t\t\t\t}]\n\t\t            },\n\t\t            states: {\n\t\t                prompt: {\n\t\t                    ...promptAndAsk(\"Who are you meeting with?\")\n\t\t                },\n\t\t                nomatch: {\n\t\t                    entry: say(\"Sorry I don't know them\"),\n\t\t                    on: { ENDSPEECH: \"prompt\" }\n\t\t                }\n\t\t            }\n\t\t        },\n\t\t        day: {\n\t\t            initial: \"prompt\",\n\t\t            on: {\n\t\t                RECOGNISED: [{\n\t\t                    cond: (context) => \"day\" in (grammar[context.recResult] || {}),\n\t\t                    actions: assign((context) => { return { day: grammar[context.recResult].day } }),\n\t\t                    target: \"whole_day_query\"\n\t\t\n\t\t                },\n\t\t                { \n\t\t\t\t\t\t\ttarget: \".nomatch\",\n\t\t\t\t\t\t\tcond: (context) => !commands.includes(context.recResult)\n\t\t\t\t\t\t}]\n\t\t            },\n\t\t            states: {\n\t\t                prompt: {\n\t\t                    entry: send((context) => ({\n\t\t                        type: \"SPEAK\",\n\t\t                        value: `OK. ${context.person}. On which day is your meeting?`\n\t\t                    })),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                },\n\t\t                ask: {\n\t\t\t                entry: [\n\t\t\t\t\t\t\t\tsend('LISTEN'),\n\t\t\t\t\t\t\t\tsend( 'MAXSPEECH', { delay: 5000, id: 'maxspeech_cancel' } )\n\t\t\t\t\t\t\t]\n\t\t\t            },\n\t\t                nomatch: {\n\t\t                    entry: say(\"Can you please repeat that\"),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                }\n\t\t            }\n\t\t        },\n\t\t        whole_day_query: {\n\t\t            initial: \"prompt\",\n\t\t            on: {\n\t\t                RECOGNISED: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcond: (context) => \"bool_val\" in (grammar[context.recResult] || {}) && (grammar[context.recResult].bool_val == false),\n\t\t                    actions: assign((context) => { return { bool_val: grammar[context.recResult].bool_val } }),\n\t\t                    target: \"meeting_time_query\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcond: (context) => \"bool_val\" in (grammar[context.recResult] || {}) && (grammar[context.recResult].bool_val == true),\n\t\t                    actions: assign((context) => { return { bool_val: grammar[context.recResult].bool_val } }),\n\t\t                    target: \"confirm_full_day\"\n\t\t\t\t\t\t},\n\t\t                { \n\t\t\t\t\t\t\ttarget: \".nomatch\" ,\n\t\t\t\t\t\t\tcond: (context) => !commands.includes(context.recResult)\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t}]\n\t\t            },\n\t\t            states: {\n\t\t                prompt: {\n\t\t                    entry: send((context) => ({\n\t\t                        type: \"SPEAK\",\n\t\t                        value: `Will the meeting take the whole day?`\n\t\t                    })),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                },\n\t\t                ask: {\n\t\t\t                entry: [\n\t\t\t\t\t\t\t\tsend('LISTEN'),\n\t\t\t\t\t\t\t\tsend( 'MAXSPEECH', { delay: 5000, id: 'maxspeech_cancel' } )\n\t\t\t\t\t\t\t]\n\t\t\t            },\n\t\t                nomatch: {\n\t\t                    entry: say(\"Can you please repeat that\"),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                },\n\t\t            }\n\t\t        },\n\t\t        meeting_time_query: {\n\t\t            initial: \"prompt\",\n\t\t            on: {\n\t\t                RECOGNISED: [{\n\t\t                    cond: (context) => \"time\" in (grammar[context.recResult] || {}),\n\t\t                    actions: assign((context) => { return { time: grammar[context.recResult].time } }),\n\t\t                    target: \"confirm_day_and_time\"\n\t\t\n\t\t                },\n\t\t                { \n\t\t\t\t\t\t\ttarget: \".nomatch\" ,\n\t\t\t\t\t\t\tcond: (context) => !commands.includes(context.recResult)\n\t\t\t\t\t\t}]\n\t\t            },\n\t\t            states: {\n\t\t                prompt: {\n\t\t                    entry: send((context) => ({\n\t\t                        type: \"SPEAK\",\n\t\t                        value: `What time is the meeting?`\n\t\t                    })),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                },\n\t\t                ask: {\n\t\t\t                entry: [\n\t\t\t\t\t\t\t\tsend('LISTEN'),\n\t\t\t\t\t\t\t\tsend( 'MAXSPEECH', { delay: 5000, id: 'maxspeech_cancel' } )\n\t\t\t\t\t\t\t]\n\t\t\t            },\n\t\t                nomatch: {\n\t\t                    entry: say(\"Can you please repeat that\"),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                },\n\t\t            }\n\t\t        },\n\t\t\t\tconfirm_day_and_time: {\n\t\t            initial: \"prompt\",\n\t\t            on: {\n\t\t                RECOGNISED: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcond: (context) => \"bool_val\" in (grammar[context.recResult] || {}) && (grammar[context.recResult].bool_val == false),\n\t\t                    actions: assign((context) => { return { bool_val: grammar[context.recResult].bool_val } }),\n\t\t                    target: \"#init\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcond: (context) => \"bool_val\" in (grammar[context.recResult] || {}) && (grammar[context.recResult].bool_val == true),\n\t\t                    actions: assign((context) => { return { bool_val: grammar[context.recResult].bool_val } }),\n\t\t                    target: \"finalise\"\n\t\t\t\t\t\t},\n\t\t                { \n\t\t\t\t\t\t\ttarget: \".nomatch\" ,\n\t\t\t\t\t\t\tcond: (context) => !commands.includes(context.recResult)\n\t\t\t\t\t\t}]\n\t\t            },\n\t\t            states: {\n\t\t                prompt: {\n\t\t                    entry: send((context) => ({\n\t\t                        type: \"SPEAK\",\n\t\t                        value: `Do you want to create an appointment with ${context.person} on ${context.day} at ${context.time}?`\n\t\t                    })),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                },\n\t\t                ask: {\n\t\t\t                entry: [\n\t\t\t\t\t\t\t\tsend('LISTEN'),\n\t\t\t\t\t\t\t\tsend( 'MAXSPEECH', { delay: 5000, id: 'maxspeech_cancel' } )\n\t\t\t\t\t\t\t]\n\t\t\t            },\n\t\t                nomatch: {\n\t\t                    entry: say(\"Can you please repeat that\"),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                },\n\t\t            }\n\t\t        },\n\t\t\t\tconfirm_full_day: {\n\t\t            initial: \"prompt\",\n\t\t            on: {\n\t\t                RECOGNISED: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcond: (context) => \"bool_val\" in (grammar[context.recResult] || {}) && (grammar[context.recResult].bool_val == false),\n\t\t                    actions: assign((context) => { return { bool_val: grammar[context.recResult].bool_val } }),\n\t\t                    target: \"#init\"\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcond: (context) => \"bool_val\" in (grammar[context.recResult] || {}) && (grammar[context.recResult].bool_val == true),\n\t\t                    actions: assign((context) => { return { bool_val: grammar[context.recResult].bool_val } }),\n\t\t                    target: \"finalise\"\n\t\t\t\t\t\t},\n\t\t                { \n\t\t\t\t\t\t\ttarget: \".nomatch\" ,\n\t\t\t\t\t\t\tcond: (context) => !commands.includes(context.recResult)\n\t\t\t\t\t\t}]\n\t\t            },\n\t\t            states: {\n\t\t                prompt: {\n\t\t                    entry: send((context) => ({\n\t\t                        type: \"SPEAK\",\n\t\t                        value: `Do you want to create an appointment with ${context.person} on ${context.day} for the whole day?`\n\t\t                    })),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                },\n\t\t                ask: {\n\t\t\t                entry: [\n\t\t\t\t\t\t\t\tsend('LISTEN'),\n\t\t\t\t\t\t\t\tsend( 'MAXSPEECH', { delay: 5000, id: 'maxspeech_cancel' } )\n\t\t\t\t\t\t\t]\n\t\t\t            },\n\t\t                nomatch: {\n\t\t                    entry: say(\"Can you please repeat that\"),\n\t\t                    on: { ENDSPEECH: \"ask\" }\n\t\t                },\n\t\t            }\n\t\t        },\n\t\t\t\tfinalise: {\n\t\t\t\t\tentry: say(\"Your appointment has been created.\"),\n\t\t\t\t\ton: { ENDSPEECH: \"#init.main\" }\n\t\t\t\t},\n\t\t\t\tsay_error: {\n\t\t\t\t\ttarget: 'main',\n\t\t\t\t\tactions: say(\"Sorry, there was an error. \")\n\t\t\t\t},\n\t\t    },\n\t\t},\n\t\tmaxspeech: {\n\t\t\tentry: say(\"Sorry,\"),\n\t\t\ton: {\n\t\t\t\tENDSPEECH: [\n\t\t\t\t\t{\n\t\t\t\t\t\tcond: (context)=> context.maxspeech_count < 3,\n\t\t\t\t\t\ttarget: 'main.hist'\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tactions: [\n\t\t\t\t\t\t\tassign((context) => { return { maxspeech_count: 0 } }),\n\t\t\t\t\t\t\tsay(\"Cancelled because you don't say nutting\")\n\t\t\t\t\t\t],\n\t\t\t\t\t\ttarget: '#init'\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t},\n\t\tstop: {\n\t\t\tentry: say(\"Ok, program stopped\"),\n\t\t\ttarget: 'main'\n\t\t},\n\t\thelp: {\n\t\t\tentry: say(\"I'm supposed to help you but I won't\"),\n\t\t\ttarget: 'main'\n\t\t},\n\t},\n\t\t\n})\n\n\n\n\n\n\n\n\n\n"]},"metadata":{},"sourceType":"module"}