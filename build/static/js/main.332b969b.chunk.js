(this["webpackJsonpxstate-react-typescript-template"]=this["webpackJsonpxstate-react-typescript-template"]||[]).push([[0],{29:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var o=n(26),a=n(11),s=(n(29),n(7),n(23)),r=n(10),i=n(20),c=n(2),l=n(44),h=n(43);const d=r.a.send;r.a.cancel;function u(e){return d((t=>({type:"SPEAK",value:e})))}const p={operate:function(e,t,n){switch(n){case"plus":return e+t;case"subtract":return e-t;case"times":return e*t}},generate_number:function(e){switch(e){case"plus":case"subtract":return Math.floor(100*Math.random());case"times":return Math.floor(12*Math.random())}},parse_asr_numbers:function(e){const t={0:"zero",1:"one",2:"two",3:"three",4:"four",5:"five",6:"six",7:"seven",8:"eight",9:"nine"};for(var n=0;n<t.length;n++)e=e.replace(t[n],n);return(e=(e=(e=e.replace("for",4)).replace("to",2)).replace("too",2)).split(/[\s--,.+]/).join("")},0:{operator:"plus"},1:{operator:"subtract"},2:{operator:"times"},3:{operator:"divide"}},g={0:{riddle:"What has to be broken before you can use it?",answers:["egg","an egg"],hint:"I like them scrambled. "},1:{riddle:"What gets wet while drying?",answers:["towel","a towel","towels"],hint:"You'll have to take one to the beach if you want to take a swim. "},2:{riddle:"What can you give and still hold on to?",answers:["promise","a promise","promises","your word"],hint:"Relationships are more secure with these. "},3:{riddle:"The more of this there is, the less you see. What is it?",answers:["darkness","the dark"],hint:"This descibes the absence rather than the presence of something. "},4:{riddle:"This is as light as a feather, but you can't hold it too long. ",answers:["your breath","breath","the breath","a breath"],hint:"Don't forget to do this or you'll die."},5:{riddle:"Before Mount Everest was discovered, what was the highest mountain on Earth?",answers:["everest","mount everest"],hint:"If nobody is there to observe it does that mean it is not true?"},6:{riddle:"What runs around the whole yard without moving?",answers:["a fence","fence","fences"],hint:"Some things described as running may be static. "},7:{riddle:"What can you catch, but never throw?",answers:["a cold","a virus","a sickness","a disease","cold","virus","sickness","disease","colds","viruses","sicknesses","diseases"],hint:"Covid 19 has not been a great thing for the world. "}};const E=["stop","help"];var m=0;const y={initial:"main",id:"init",context:{maxspeech_count:0},on:{MAXSPEECH:".maxspeech",RECOGNISED:[{target:".stop",cond:e=>"stop"===e.recResult},{target:".help",cond:e=>"help"===e.recResult}]},states:{main:{initial:"clicky",states:{hist:{type:"history",history:"shallow"},clicky:{on:{CLICK:{target:"begin",actions:Object(c.b)((e=>(m=0,{maxspeech_count:0})))}}},begin:{initial:"prompt",id:"welcome",on:{MAX_HTTP:{target:"#init",actions:u("The RASA server is taking too long to respond. Please wait and try again. ")},NLU_REQ_DONE:[{cond:e=>"chimp_test"===e.snippet,target:"chimp_test"},{target:"quick_math",cond:(e,t)=>"quick_math"===e.snippet},{target:"riddles",cond:e=>"riddles"===e.snippet},{target:".re_prompt"}],RECOGNISED:".nlu_process",MAXSPEECH:".too_long"},states:{prompt:Object(a.a)({},(b="Hello! You have a selection of one of the following mini games. You can choose between quick maths, riddles or the number memory test. You can also tell me to stop or ask for help at any time. ",{initial:"prompt",states:{prompt:{entry:u(b),on:{ENDSPEECH:"ask"}},ask:{entry:[d("LISTEN"),d("MAXSPEECH",{delay:6e3,id:"maxspeech_cancel"})]}}})),nlu_process:{initial:"http_timer",invoke:{id:"rasaquery",src:(e,t)=>fetch(new Request("https://cors-anywhere.herokuapp.com/https://herokufinalproj.herokuapp.com/model/parse",{method:"POST",headers:{Origin:"http://localhost:3000/"},body:'{"text": "'.concat(e.recResult,'"}')})).then((e=>e.json())),onDone:"completed_query",onError:{target:"#init",actions:u("Sorry, there was an error. ")}},states:{http_timer:{entry:d("MAX_HTTP",{delay:12e3,id:"maxspeech_cancel"})}}},re_prompt:{entry:u("Sorry, I didn't quite get that. Repeat yoself!"),on:{ENDSPEECH:"ask"}},ask:{entry:[d("LISTEN"),d("MAXSPEECH",{delay:7e3,id:"maxspeech_cancel"})]},completed_query:{entry:[Object(c.b)(((e,t)=>(console.log(t.data.intent.name),{snippet:t.data.intent.name||"unconfident_resp"}))),d("NLU_REQ_DONE")]},too_long:{entry:u("Still there?"),on:{ENDSPEECH:[{target:"#init",cond:e=>e.maxspeech_counter>2,actions:u("As you haven't responded; resetting...")},{target:"ask",actions:Object(c.b)((e=>({maxspeech_counter:(e.maxspeech_counter||0)+1})))}]}}}},quick_math:{id:"quick_math",initial:"generate_math_question",on:{MAXSPEECH:".too_long",RECOGNISED:[{target:".right_answer",cond:e=>e.recResult===e.solution.toString(),actions:Object(c.b)((e=>({points:(e.points||0)+1,wrong_math:0})))},{target:".wrong_answer",cond:e=>!E.includes(e.recResult)}]},states:{generate_math_question:{entry:u("Here is your maths question"),on:{ENDSPEECH:{target:"ask_math_question",actions:Object(c.b)((e=>{var t=Math.floor(3*Math.random()),n=p[t].operator;return{number_one:p.generate_number(n),number_two:p.generate_number(n),operator_id:t}}))}}},ask_math_question:{entry:d((e=>({type:"SPEAK",value:"What is ".concat(e.number_one," ").concat(p[e.operator_id].operator," ").concat(e.number_two,".")}))),on:{ENDSPEECH:{target:"ask",actions:Object(c.b)((e=>({solution:p.operate(e.number_one,e.number_two,p[e.operator_id].operator)})))}}},wrong_answer:{entry:u("Sorry, that's wrong!"),on:{ENDSPEECH:[{target:"try_again",actions:Object(c.b)((e=>({wrong_math:(e.wrong_math||0)+1}))),cond:e=>(e.wrong_math||0)<2},{target:"#init",actions:u("... and you've gotten it wrong a couple of times now! Resetting...")}]}},right_answer:{entry:d((e=>({type:"SPEAK",value:"Nice, that's right. You have ".concat(e.points," ").concat(1===e.points?"point":"points",".")}))),on:{ENDSPEECH:{target:"generate_math_question"}}},too_long:{entry:u("Still there?"),on:{ENDSPEECH:[{target:"#init",cond:e=>e.maxspeech_counter>2,actions:[Object(c.b)((e=>({maxspeech_counter:0}))),u("As you haven't responded; resetting...")]},{target:"ask",actions:Object(c.b)((e=>({maxspeech_counter:(e.maxspeech_counter||0)+1})))}]}},try_again:{entry:u("Try again."),on:{ENDSPEECH:"ask"}},ask:{entry:[d("LISTEN"),d("MAXSPEECH",{delay:7e3,id:"maxspeech_cancel"})]}}},riddles:{id:"riddles",initial:"prompt",on:{MAXSPEECH:".too_long",RECOGNISED:[{cond:e=>g[e.riddle_id].answers.includes(e.recResult),actions:[Object(c.b)((e=>({wrong_riddle:0})))],target:".another_riddle"},{cond:e=>"hint"==e.recResult||"hint please"==e.recResult,target:".hint"},{target:".wrong_answer",cond:e=>!E.includes(e.recResult)}]},states:{prompt:{entry:u("Guess the answer to the riddle. Don't be afraid to ask for a hint. Here is your riddle: "),on:{ENDSPEECH:{target:"ask_riddle",actions:Object(c.b)((e=>({riddle_id:Math.floor(7*Math.random())})))}}},hint:{entry:d((e=>({type:"SPEAK",value:"The hint is:\n ".concat(g[e.riddle_id].hint," Now tell me...")}))),on:{ENDSPEECH:"ask"}},ask_riddle:{entry:d((e=>({type:"SPEAK",value:"".concat(g[e.riddle_id].riddle)}))),on:{ENDSPEECH:"ask"}},too_long:{entry:u("Hello?"),on:{ENDSPEECH:[{target:"#init",actions:u("As you haven't responded, resetting..."),cond:e=>e.maxspeech_counter>1},{target:"ask",actions:[Object(c.b)((e=>({maxspeech_counter:(e.maxspeech_counter||0)+1})))]}]}},wrong_answer:{entry:u("Sorry, that's wrong!"),on:{ENDSPEECH:[{target:"try_again",actions:Object(c.b)((e=>({wrong_riddle:(e.wrong_riddle||0)+1}))),cond:e=>(e.wrong_riddle||0)<2},{target:"#init",actions:u("You've gotten it wrong a couple of times now! Resetting...")}]}},try_again:{entry:u("Try again."),on:{ENDSPEECH:"ask"}},another_riddle:{initial:"ask",on:{ENDSPEECH:".ask",RECOGNISED:[{target:"prompt",actions:Object(c.b)((e=>({riddle_id:Math.floor(7*Math.random())}))),cond:e=>"yes"==(e.recResult||"invalid")},{target:"#init",actions:u("Ok, resetting.")}]},states:{ask:{entry:u("Well done, that is correct! Would you like another riddle?"),on:{ENDSPEECH:"listen"}},listen:{entry:[d("LISTEN"),d("MAXSPEECH",{delay:15e3,id:"maxspeech_cancel"})]}}},ask:{entry:[d("LISTEN"),d("MAXSPEECH",{delay:15e3,id:"maxspeech_cancel"})]}}},chimp_test:{id:"chimp_test",initial:"prompt",on:{RECOGNISED:[{target:".correct_sequence",actions:Object(c.b)((e=>(e.sequence.push(Math.floor(9*Math.random())),{one_try_given:!1}))),cond:e=>p.parse_asr_numbers(e.recResult)===e.sequence.join("")},{target:".wrong_sequence",cond:e=>!E.includes(e.recResult)}],MAXSPEECH:".too_long"},states:{prompt:{entry:u("This is the number memory test. I will say an ever increasing sequence of numbers which you need to repeat back to me. If you can't recall a sequence you lose. Try to get the highest score!"),on:{ENDSPEECH:{target:"say_sequence",actions:Object(c.b)((e=>({sequence:[Math.floor(9*Math.random())]})))}}},say_sequence:{entry:d((e=>({type:"SPEAK",value:"The ".concat(1===e.sequence.length?"first":"next"," number is ").concat(e.sequence[e.sequence.length-1],". Repeat back the sequence")}))),on:{ENDSPEECH:"ask"}},correct_sequence:{entry:d((e=>({type:"SPEAK",value:"Good job! You have ".concat(e.sequence.length-1," ").concat(e.sequence.length-1===1?"point":"points",".")}))),on:{ENDSPEECH:"say_sequence"}},wrong_sequence:{entry:u("That is incorrect. "),on:{ENDSPEECH:[{target:"say_sequence",cond:e=>!e.one_try_given,actions:[Object(c.b)((e=>({one_try_given:!0}))),u("I will give you one more chance to get that right or you lose.")]},{actions:d((e=>({type:"SPEAK",value:"You ended with ".concat(e.sequence.length-1," points")}))),target:"#init"}]}},ask:{entry:[d("LISTEN"),d("MAXSPEECH",{delay:e=>4e3+1e3*e.sequence.length,id:"maxspeech_cancel"})]},too_long:{entry:u("Hello?"),on:{ENDSPEECH:[{target:"#init",actions:u("As you haven't responded, resetting..."),cond:e=>e.maxspeech_counter>1},{target:"ask",actions:[Object(c.b)((e=>({maxspeech_counter:(e.maxspeech_counter||0)+1})))]}]}}}},please_repeat:{id:"please_repeat",initial:"prompt",states:{prompt:{entry:u("Sorry, I didn't get that. ")}},on:{ENDSPEECH:"#init"}}}},maxspeech:{initial:"apologies",on:{ENDSPEECH:[{target:"#init.main.hist",cond:function(){return m<2},actions:[function(){m++},Object(c.b)((e=>{}))]},{target:"#init",actions:[function(){m=0},u("and you haven't responded in a while. Resetting."),Object(c.b)((e=>{}))]}]},states:{apologies:{entry:u("Sorry, I couldn't hear you. ")}}},stop:{entry:u("Ok, program stopped"),on:{ENDSPEECH:{target:"#init"}}},help:{entry:u("Here is a help message, but you made the game, so you shouldn't need one. Going back to the game..."),on:{ENDSPEECH:{target:"main.hist"}}}}};var b,_=n(22),S=n(12);const w=r.a.send,O=r.a.cancel;Object(h.a)({url:"https://statecharts.io/inspect",iframe:!1});const k=Object(i.a)({id:"root",type:"parallel",states:{dm:Object(a.a)({},y),asrtts:{initial:"idle",states:{idle:{on:{LISTEN:"recognising",SPEAK:{target:"speaking",actions:Object(c.b)(((e,t)=>({ttsAgenda:t.value})))}}},recognising:{initial:"progress",entry:"recStart",exit:"recStop",on:{ASRRESULT:{actions:["recLogResult",Object(c.b)(((e,t)=>({recResult:t.value.toLowerCase()})))],target:".match"},RECOGNISED:{actions:[O("maxspeech_cancel")],target:"idle"},MAXSPEECH:[{target:"idle"}]},states:{progress:{},match:{entry:w("RECOGNISED")}}},speaking:{entry:"ttsStart",on:{ENDSPEECH:"idle"}}}}}},{actions:{recLogResult:e=>{console.log("<< ASR: "+e.recResult)},test:()=>{console.log("test")},logIntent:e=>{console.log("<< NLU intent: "+e.nluData.intent.name)}}}),j=e=>{switch(!0){case e.state.matches({asrtts:"recognising"}):return Object(S.jsx)("button",Object(a.a)(Object(a.a)({type:"button",className:"glow-on-hover",style:{animation:"glowing 20s linear"}},e),{},{children:"Listening..."}));case e.state.matches({asrtts:"speaking"}):return Object(S.jsx)("button",Object(a.a)(Object(a.a)({type:"button",className:"glow-on-hover",style:{animation:"bordering 1s infinite"}},e),{},{children:"Speaking..."}));default:return Object(S.jsx)("button",Object(a.a)(Object(a.a)({type:"button",className:"glow-on-hover"},e),{},{children:"Click to start"}))}};function C(){const e=Object(_.useSpeechSynthesis)({onEnd:()=>{u("ENDSPEECH")}}),t=e.speak,n=e.cancel,a=(e.speaking,e.voices),s=Object(_.useSpeechRecognition)({onResult:e=>{u({type:"ASRRESULT",value:e}),console.log(e)}}),r=s.listen,i=(s.listening,s.stop),c=Object(l.b)(k,{devTools:!0,actions:{recStart:Object(l.a)((()=>{console.log("LETS GOOOOOO"),r({lang:"en-AU",interimResults:!1,continuous:!0})})),recStop:Object(l.a)((()=>{console.log("Recognition stopped."),i()})),changeColour:Object(l.a)((e=>{console.log("Repainting..."),document.body.style.background=e.recResult})),ttsStart:Object(l.a)(((e,n)=>{console.log("Speaking..."),t({text:e.ttsAgenda,voice:a[0]})})),ttsCancel:Object(l.a)(((e,t)=>{console.log("TTS STOP..."),n()}))}}),h=Object(o.a)(c,3),d=h[0],u=h[1];h[2];return Object(S.jsxs)("div",{className:"App",children:[Object(S.jsx)("h1",{className:"scoring",children:d.context.ttsAgenda||"Welcome"}),Object(S.jsx)(j,{state:d,onClick:()=>u("CLICK")})]})}const v=document.getElementById("root");s.render(Object(S.jsx)(C,{}),v)}},[[40,1,2]]]);
//# sourceMappingURL=main.332b969b.chunk.js.map